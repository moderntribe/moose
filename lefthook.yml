# Lefthook git hooks
# Refer for explanation to following link:
# https://github.com/evilmartians/lefthook/blob/master/docs/full_guide.md

# only show errors
skip_output:
  - meta
  - success
  - summary

# code linting
pre-commit:
  parallel: true
  jobs:
    - name: phpcs
      run: ./vendor/bin/phpcs -- {staged_files}
      glob:
        - ".phpstorm.meta.php"
        - "local-config-sample.php"
        - "wp-config.php"
        - "wp-config-environment.php"
        - "wp-content/themes/core/*.php"
        - "wp-content/plugins/core/*.php"
    - name: phpstan
      run: ./vendor/bin/phpstan analyse --memory-limit=-1
      glob:
        - ".phpstorm.meta.php"
        - "local-config-sample.php"
        - "wp-config.php"
        - "wp-config-environment.php"
        - "wp-content/themes/core/*.php"
        - "wp-content/plugins/core/*.php"
    - name: lintcss
      run: ./node_modules/.bin/wp-scripts lint-style {staged_files}
      glob:
        - "wp-content/themes/core/*.pcss"
    - name: lintjs
      run: ./node_modules/.bin/wp-scripts lint-js {staged_files}
      glob:
        - "wp-content/themes/core/*.js"
    - name: lintconfigs
      run: ./node_modules/.bin/wp-scripts lint-js {staged_files}
      glob:
        - "browsersync.config.js"
        - "postcss.config.js"
        - "webpack.config.js"
    - name: lintpkgjson
      run: ./node_modules/.bin/wp-scripts lint-pkg-json {staged_files}
      glob:
        - "package.json"


# prefix with jira ticket
prepare-commit-msg:
  scripts:
    "prefix-with-jira-ticket.php":
      runner: php
